(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fc641a5a"],{"1ec92":function(e,t,r){"use strict";r("7762")},2666:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("breadcrumb-nav",{scopedSlots:e._u([{key:"firstMenu",fn:function(){return[e._v("用户管理")]},proxy:!0},{key:"secondMenu",fn:function(){return[e._v("用户列表")]},proxy:!0}])}),r("el-card",{staticClass:"box-card"},[r("user-search-and-add",{attrs:{queryInfo:e.queryInfo},on:{"user-list":e.updateUserList}}),r("user-table",{attrs:{"user-list":e.userList,"query-info":e.queryInfo},on:{"user-list":e.updateUserList}}),r("user-pagination",{attrs:{"query-info":e.queryInfo,total:e.total},on:{"page-size-change":e.handleSizeChange,"current-page-change":e.handleSizeChange}})],1)],1)},a=[],l=r("ae71"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-input",{attrs:{placeholder:"请输入内容",clearable:""},on:{clear:e.search},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],1),r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addDialogVisible=!0}}},[e._v("添加用户")])],1)],1),r("el-dialog",{attrs:{title:"添加用户",visible:e.addDialogVisible,width:"50%"},on:{"update:visible":function(t){e.addDialogVisible=t},close:e.addDialogClose}},[r("el-form",{ref:"addUserFormRef",attrs:{model:e.addUserForm,rules:e.addUserFormRules,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"用户名",prop:"username"}},[r("el-input",{model:{value:e.addUserForm.username,callback:function(t){e.$set(e.addUserForm,"username",t)},expression:"addUserForm.username"}})],1),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.addUserForm.password,callback:function(t){e.$set(e.addUserForm,"password",t)},expression:"addUserForm.password"}})],1),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{type:"email"},model:{value:e.addUserForm.email,callback:function(t){e.$set(e.addUserForm,"email",t)},expression:"addUserForm.email"}})],1),r("el-form-item",{attrs:{label:"手机",prop:"mobile"}},[r("el-input",{model:{value:e.addUserForm.mobile,callback:function(t){e.$set(e.addUserForm,"mobile",t)},expression:"addUserForm.mobile"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.addUser}},[e._v("确 定")])],1)],1)],1)},o=[],n=r("1bab");function u(e){return Object(n["a"])({url:"/users",params:{...e}})}function d(e,t){return Object(n["a"])({url:`users/${e}/state/${t}`,method:"put"})}function c(e){return Object(n["a"])({url:"/users",method:"post",data:{...e}})}function m(e){return Object(n["a"])({url:"/users/"+e})}function f(e){return Object(n["a"])({url:"/users/"+e.id,method:"put",data:{email:e.email,mobile:e.mobile}})}function p(e){return Object(n["a"])({url:"/users/"+e,method:"delete"})}function b(e,t){return Object(n["a"])({url:`users/${e}/role`,method:"put",data:{rid:t}})}let g=(e,t,r)=>{let s=/^[a-zA-Z0-9]+([-_.][a-zA-Z0-9]+)*@[a-zA-Z0-9]+([-_.][a-zA-Z0-9]+)*\.[a-z]{2,}$/;if(!s.test(t))return r(new Error("请输入合法的邮箱"));r()},h=(e,t,r)=>{let s=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;if(!s.test(t))return r(new Error("请输入合法的手机号"));r()};var U={name:"UserSearchAndAdd",props:{queryInfo:{type:Object,default(){return{query:"",pagenum:1,pagesize:2}}}},data(){return{addDialogVisible:!1,addUserForm:{username:"",password:"",email:"",mobile:""},addUserFormRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:10,message:"长度需要在2到10之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:15,message:"长度需要在6到15之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:g,trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:h,trigger:"blur"}]}}},methods:{search(){this.$emit("user-list")},addDialogClose(){this.$refs.addUserFormRef.resetFields()},addUser(){this.$refs.addUserFormRef.validate(e=>{e&&c(this.addUserForm).then(e=>{let t=e.data;if(201!==t.meta.status)return this.alertMessage("添加用户失败","error");this.alertMessage("添加用户成功","success"),this.addDialogVisible=!1,this.$emit("user-list")})})}}},v=U,y=r("2877"),_=Object(y["a"])(v,i,o,!1,null,"0049521e",null),w=_.exports,F=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-pagination",{attrs:{"current-page":e.queryInfo.pagenum,"page-sizes":[1,2,5,10],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},$=[],D={name:"UserPagination",props:{queryInfo:{type:Object,default(){return{query:"",pagenum:1,pagesize:2}}},total:{type:Number,default:0}},data(){return{}},methods:{handleSizeChange(e){this.$emit("page-size-change",e)},handleCurrentChange(e){this.$emit("current-page-change",e)}}},R=D,q=Object(y["a"])(R,F,$,!1,null,"08d7ba3e",null),I=q.exports,j=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-table",{attrs:{data:e.userList,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"index"}}),r("el-table-column",{attrs:{prop:"username",label:"姓名"}}),r("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),r("el-table-column",{attrs:{prop:"mobile",label:"电话"}}),r("el-table-column",{attrs:{prop:"role_name",label:"角色"}}),r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("user-set-state",{attrs:{state:e.row.mg_state,userinfo:e.row}})]}}])}),r("el-table-column",{staticClass:"btns",attrs:{label:"操作",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("user-edit-dialog",{attrs:{"user-id":t.row.id},on:{"user-list":e.updateUserList}}),r("user-remove-dialog",{attrs:{"user-id":t.row.id},on:{"user-list":e.updateUserList}}),r("user-set-role",{attrs:{role:t.row},on:{"user-list":e.updateUserList}})]}}])})],1)},x=[],k=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-switch",{on:{change:function(t){return e.userStateChange(e.userinfo)}},model:{value:e.nowState,callback:function(t){e.nowState=t},expression:"nowState"}})],1)},z=[],O={name:"UserSetState",props:{state:{type:Boolean,required:!0},userinfo:{type:Object,default(){return{}}}},data(){return{nowState:this.state}},methods:{userStateChange(e){d(e.id,this.nowState).then(e=>{let t=e.data;if(console.log("修改状态",t),200!==t.meta.status)return this.nowState=!this.nowState,this.alertMessage("更新状态失败","error");this.alertMessage("更新状态成功","success")})}}},S=O,C=Object(y["a"])(S,k,z,!1,null,"8dc3be10",null),L=C.exports,M=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"editDialog"},[r("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return e.showEditDialog(e.userId)}}}),r("el-dialog",{attrs:{title:"修改用户",visible:e.editDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editDialogVisible=t},close:e.editDialogClose}},[r("el-form",{ref:"editUserFormRef",attrs:{model:e.editUserForm,rules:e.editUserFormRules,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"用户名"}},[r("el-input",{attrs:{disabled:""},model:{value:e.editUserForm.username,callback:function(t){e.$set(e.editUserForm,"username",t)},expression:"editUserForm.username"}})],1),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{model:{value:e.editUserForm.email,callback:function(t){e.$set(e.editUserForm,"email",t)},expression:"editUserForm.email"}})],1),r("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[r("el-input",{model:{value:e.editUserForm.mobile,callback:function(t){e.$set(e.editUserForm,"mobile",t)},expression:"editUserForm.mobile"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.editUserInfo}},[e._v("确 定")])],1)],1)],1)},V=[];let E=(e,t,r)=>{let s=/^[a-zA-Z0-9]+([-_.][a-zA-Z0-9]+)*@[a-zA-Z0-9]+([-_.][a-zA-Z0-9]+)*\.[a-z]{2,}$/;if(!s.test(t))return r(new Error("请输入合法的邮箱"));r()},A=(e,t,r)=>{let s=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;if(!s.test(t))return r(new Error("请输入合法的手机号"));r()};var N={name:"UserEditDialog",props:{userId:{type:Number,default:0}},data(){return{editDialogVisible:!1,editUserForm:{username:"",email:"",mobile:""},editUserFormRules:{email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:E,trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:A,trigger:"blur"}]}}},methods:{showEditDialog(e){this.editDialogVisible=!0,m(e).then(e=>{let t=e.data;if(200!==t.meta.status)return this.alertMessage("获取用户信息失败","error");this.editUserForm=t.data})},editDialogClose(){this.$refs.editUserFormRef.resetFields()},editUserInfo(){this.$refs.editUserFormRef.validate(e=>{e&&f(this.editUserForm).then(e=>{let t=e.data;if(200!==t.meta.status)return this.alertMessage("更新用户信息失败","error");this.alertMessage("更新用户信息成功","success"),this.editDialogVisible=!1,this.$emit("user-list")})})}}},Z=N,B=(r("1ec92"),Object(y["a"])(Z,M,V,!1,null,"5a8dca9d",null)),T=B.exports,J=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){return e.removeUserById(e.userId)}}})},P=[],G={name:"UserRemoveDialog",props:{userId:{type:Number,default:0}},data(){return{}},methods:{removeUserById(e){this.$confirm("此操作将删除该该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{p(e).then(e=>{let t=e.data;if(200!==t.meta.status)return this.alertMessage("删除失败","error");this.alertMessage("删除成功","success"),this.$emit("user-list")})}).catch(()=>{this.alertMessage("已取消删除","info")})}}},H=G,K=Object(y["a"])(H,J,P,!1,null,"45ba4023",null),Q=K.exports,W=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"setDialog"},[r("el-tooltip",{attrs:{effect:"dark",content:"分配角色",placement:"top-start",enterable:!1}},[r("el-button",{attrs:{type:"warning",icon:"el-icon-setting",size:"mini"},on:{click:function(t){return e.showSetRoleDialog(e.role)}}})],1),r("el-dialog",{attrs:{title:"分配角色",visible:e.setRoleDialogVisible,width:"50%"},on:{"update:visible":function(t){e.setRoleDialogVisible=t},close:e.setRoleDialogClose}},[r("div",[r("p",[e._v("当前用户："+e._s(e.userinfo.username))]),r("p",[e._v("当前角色："+e._s(e.userinfo.role_name))]),r("p",[e._v(" 分配新角色： "),r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.selectRoleId,callback:function(t){e.selectRoleId=t},expression:"selectRoleId"}},e._l(e.rolesList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})})),1)],1)]),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.setRoleDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.allotRole}},[e._v("确 定")])],1)])],1)},X=[],Y=r("5a0f"),ee={name:"UserSetRole",props:{role:{type:Object,default(){return{}}}},data(){return{setRoleDialogVisible:!1,userinfo:{},rolesList:[],selectRoleId:""}},methods:{showSetRoleDialog(e){this.userinfo=e,Object(Y["f"])().then(e=>{let t=e.data;if(200!==t.meta.status)return this.alertMessage("获取角色列表失败","error");this.rolesList=t.data}),this.setRoleDialogVisible=!0},allotRole(){if(!this.selectRoleId)return this.alertMessage("请选择一个角色","error");b(this.userinfo.id,this.selectRoleId).then(e=>{let t=e.data;if(200!==t.meta.status)return this.alertMessage("更新角色失败","error");this.alertMessage("更新角色成功","success"),this.setRoleDialogVisible=!1,this.$emit("user-list")})},setRoleDialogClose(){this.selectRoleId="",this.userinfo={}}}},te=ee,re=(r("4d5e"),Object(y["a"])(te,W,X,!1,null,"01709341",null)),se=re.exports,ae={name:"UserTable",components:{UserSetState:L,UserEditDialog:T,UserRemoveDialog:Q,UserSetRole:se},props:{userList:{type:Array,default(){return[]}},queryInfo:{type:Object,default(){return{query:"",pagenum:1,pagesize:2}}}},methods:{updateUserList(){this.$emit("user-list")}}},le=ae,ie=Object(y["a"])(le,j,x,!1,null,"07bec86c",null),oe=ie.exports,ne={name:"Users",components:{BreadcrumbNav:l["a"],UserSearchAndAdd:w,UserTable:oe,UserPagination:I},data(){return{queryInfo:{query:"",pagenum:1,pagesize:2},userList:[],total:0}},created(){this.getUserList()},methods:{getUserList(){u(this.queryInfo).then(e=>{let t=e.data;if(200!==t.meta.status)return this.alertMessage("获取用户列表失败","error");this.userList=t.data.users,this.total=t.data.total})},updateUserList(){this.getUserList()},handleSizeChange(e){this.queryInfo.pagesize=e,this.getUserList()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getUserList()}}},ue=ne,de=(r("96dd"),Object(y["a"])(ue,s,a,!1,null,"29d47574",null));t["default"]=de.exports},4580:function(e,t,r){},"4d5e":function(e,t,r){"use strict";r("4580")},"5a0f":function(e,t,r){"use strict";r.d(t,"d",(function(){return a})),r.d(t,"f",(function(){return l})),r.d(t,"b",(function(){return i})),r.d(t,"e",(function(){return o})),r.d(t,"c",(function(){return n})),r.d(t,"h",(function(){return u})),r.d(t,"a",(function(){return d})),r.d(t,"g",(function(){return c}));var s=r("1bab");function a(e){return Object(s["a"])({url:"rights/"+e})}function l(e){return Object(s["a"])({url:"/roles"})}function i(e){return Object(s["a"])({url:"/roles",method:"post",data:{...e}})}function o(e){return Object(s["a"])({url:"roles/"+e})}function n(e){return Object(s["a"])({url:"roles/"+e.roleId,method:"put",data:{roleName:e.roleName,roleDesc:e.roleDesc}})}function u(e){return Object(s["a"])({url:"roles/"+e,method:"delete"})}function d(e,t){return Object(s["a"])({url:`roles/${e}/rights`,method:"post",data:{rids:t}})}function c(e,t){return Object(s["a"])({url:`roles/${e}/rights/${t}`,method:"delete"})}},7762:function(e,t,r){},"96dd":function(e,t,r){"use strict";r("ce5a")},ae71:function(e,t,r){"use strict";var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-breadcrumb",{attrs:{separator:"/"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._t("firstMenu",[e._v("一级菜单")])],2),r("el-breadcrumb-item",[e._t("secondMenu",[e._v("二级菜单")])],2)],1)},a=[],l={name:"BreadcrumbNav"},i=l,o=r("2877"),n=Object(o["a"])(i,s,a,!1,null,"2d65e998",null);t["a"]=n.exports},ce5a:function(e,t,r){}}]);
//# sourceMappingURL=chunk-fc641a5a.b66135e5.js.map