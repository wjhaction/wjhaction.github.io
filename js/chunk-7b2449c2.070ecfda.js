(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b2449c2"],{"2a7b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("breadcrumb-nav",{scopedSlots:e._u([{key:"firstMenu",fn:function(){return[e._v("商品管理")]},proxy:!0},{key:"secondMenu",fn:function(){return[e._v("添加商品")]},proxy:!0}])}),a("el-card",[a("el-alert",{attrs:{title:"添加商品信息",type:"info","show-icon":"",center:"",closable:!1}}),a("el-steps",{attrs:{space:200,active:1*e.activeIndex,"finish-status":"success","align-center":""}},[a("el-step",{attrs:{title:"基本信息"}}),a("el-step",{attrs:{title:"商品图片"}}),a("el-step",{attrs:{title:"商品内容"}}),a("el-step",{attrs:{title:"完成"}})],1),a("el-form",{ref:"addFormRef",attrs:{model:e.addForm,rules:e.addFormRules,"label-width":"100px","label-position":"top"}},[a("el-tabs",{attrs:{"tab-position":"left","before-leave":e.beforeTabLeave},on:{"tab-click":e.tabClicked},model:{value:e.activeIndex,callback:function(t){e.activeIndex=t},expression:"activeIndex"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"0"}},[a("el-form-item",{attrs:{label:"商品名称",prop:"goods_name"}},[a("el-input",{model:{value:e.addForm.goods_name,callback:function(t){e.$set(e.addForm,"goods_name",t)},expression:"addForm.goods_name"}})],1),a("el-form-item",{attrs:{label:"商品价格",prop:"goods_price"}},[a("el-input",{attrs:{type:"number",min:"0"},model:{value:e.addForm.goods_price,callback:function(t){e.$set(e.addForm,"goods_price",t)},expression:"addForm.goods_price"}})],1),a("el-form-item",{attrs:{label:"商品数量",prop:"goods_number"}},[a("el-input",{attrs:{type:"number",min:"0"},model:{value:e.addForm.goods_number,callback:function(t){e.$set(e.addForm,"goods_number",t)},expression:"addForm.goods_number"}})],1),a("el-form-item",{attrs:{label:"商品重量",prop:"goods_weight"}},[a("el-input",{attrs:{type:"number",min:"0"},model:{value:e.addForm.goods_weight,callback:function(t){e.$set(e.addForm,"goods_weight",t)},expression:"addForm.goods_weight"}})],1),a("el-form-item",{attrs:{label:"商品分类",prop:"goods_cat"}},[a("el-cascader",{attrs:{options:e.categoryList,props:e.categoryProps},on:{change:e.handleCascaderChange},model:{value:e.addForm.goods_cat,callback:function(t){e.$set(e.addForm,"goods_cat",t)},expression:"addForm.goods_cat"}})],1)],1),a("el-tab-pane",{attrs:{label:"商品图片",name:"1"}},[a("el-upload",{attrs:{action:e.uploadUrl,"on-preview":e.handleImgPreview,"on-remove":e.handleImgRemove,"list-type":"picture",headers:e.imgUploadHeaders,"on-success":e.handleImgUploadSuccess}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),a("el-tab-pane",{attrs:{label:"商品内容",name:"2"}},[a("quill-editor",{staticClass:"editor",model:{value:e.addForm.goods_introduce,callback:function(t){e.$set(e.addForm,"goods_introduce",t)},expression:"addForm.goods_introduce"}}),a("el-button",{staticClass:"addBtn",attrs:{type:"primary"},on:{click:e.addGoods}},[e._v("添加商品")])],1)],1)],1)],1),a("el-dialog",{attrs:{title:"图片预览",visible:e.previewDialogVisible,width:"50%"},on:{"update:visible":function(t){e.previewDialogVisible=t}}},[a("img",{staticClass:"previewImg",attrs:{src:e.previewImgUrl}})])],1)},o=[],s=a("ae71"),d=a("de5d"),i={name:"ListAdd",components:{BreadcrumbNav:s["a"]},data(){return{activeIndex:"0",addForm:{goods_name:"",goods_price:0,goods_number:0,goods_weight:0,goods_cat:[],pics:[],goods_introduce:"",attrs:[]},addFormRules:{goods_name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],goods_price:[{required:!0,message:"请输入商品价格",trigger:"blur"}],goods_number:[{required:!0,message:"请输入商品数量",trigger:"blur"}],goods_weight:[{required:!0,message:"请输入商品重量",trigger:"blur"}],goods_cat:[{required:!0,message:"请选择商品分类",trigger:"blur"}]},categoryList:[],categoryProps:{expandTrigger:"hover",label:"cat_name",value:"cat_id",children:"children"},manyTableData:[],onlyTableData:[],uploadUrl:"https://www.liulongbin.top:8888/api/private/v1",imgUploadHeaders:{Authorization:sessionStorage.getItem("token")},previewImgUrl:"",previewDialogVisible:!1}},computed:{cateId(){return 3===this.addForm.goods_cat.length?this.addForm.goods_cat[2]:null}},created(){this.getCategoriesList()},methods:{getCategoriesList(){Object(d["f"])({}).then(e=>{let t=e.data;if(console.log("商品分类",t),200!==t.meta.status)return this.alertMessage("获取分类列表失败","error");this.categoryList=t.data})},handleCascaderChange(){console.log(this.addForm.goods_cat),3!==this.addForm.goods_cat.length&&(this.addForm.goods_cat=[])},beforeTabLeave(e,t){if("0"===t&&3!==this.addForm.goods_cat.length)return this.alertMessage("请先选择商品分类","error"),!1},tabClicked(){"1"===this.activeIndex?Object(d["h"])(this.cateId,"many").then(e=>{let t=e.data;if(200!==t.meta.status)return this.alertMessage("获取商品参数失败","error");this.manyTableData=t.data,t.data.forEach(e=>{e.attr_vals=e.attr_vals.split(" ")}),console.log("商品参数：",t.data)}):"2"===this.activeIndex&&Object(d["h"])(this.cateId,"only").then(e=>{let t=e.data;if(200!==t.meta.status)return this.alertMessage("获取商品参数失败","error");this.onlyTableData=t.data,console.log("商品属性：",t.data)})},handleImgPreview(e){console.log("预览",e),this.previewImgUrl=e.response.data.url,this.previewDialogVisible=!0},handleImgRemove(e){console.log("将要被移除的文件:",e);let t=e.response.data.tmp_path,a=this.addForm.pics.findIndex(e=>e.tmp_path===t);this.addForm.pics.splice(a,1),console.log(this.addForm)},handleImgUploadSuccess(e){let t={pic:e.data.tmp_path};this.addForm.pics.push(t)},addGoods(){this.$refs.addFormRef.validate(e=>{if(!e)return this.alertMessage("请填写必要的表单项","error");this.manyTableData.forEach(e=>{let t={attr_id:e.attr_id,attr_value:e.attr_vals.join(" ")};this.addForm.attrs.push(t)}),this.onlyTableData.forEach(e=>{let t={attr_id:e.attr_id,attr_value:e.attr_vals};this.addForm.attrs.push(t)});let t=JSON.parse(JSON.stringify(this.addForm));t.goods_cat=t.goods_cat.join(","),console.log(t),Object(d["b"])(t).then(e=>{let t=e.data;if(console.log("添加商品",t),201!==t.meta.status)return this.alertMessage("添加失败","error");this.alertMessage("添加成功","success"),this.$router.push("/goods")})})}}},n=i,l=(a("72bb"),a("2877")),c=Object(l["a"])(n,r,o,!1,null,"41db543e",null);t["default"]=c.exports},"72bb":function(e,t,a){"use strict";a("9b51")},"9b51":function(e,t,a){},ae71:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),a("el-breadcrumb-item",[e._t("firstMenu",[e._v("一级菜单")])],2),a("el-breadcrumb-item",[e._t("secondMenu",[e._v("二级菜单")])],2)],1)},o=[],s={name:"BreadcrumbNav"},d=s,i=a("2877"),n=Object(i["a"])(d,r,o,!1,null,"2d65e998",null);t["a"]=n.exports},de5d:function(e,t,a){"use strict";a.d(t,"f",(function(){return o})),a.d(t,"a",(function(){return s})),a.d(t,"g",(function(){return d})),a.d(t,"d",(function(){return i})),a.d(t,"k",(function(){return n})),a.d(t,"h",(function(){return l})),a.d(t,"c",(function(){return c})),a.d(t,"j",(function(){return u})),a.d(t,"e",(function(){return m})),a.d(t,"m",(function(){return g})),a.d(t,"i",(function(){return p})),a.d(t,"l",(function(){return b})),a.d(t,"b",(function(){return h}));var r=a("1bab");function o(e){return Object(r["a"])({url:"/categories",params:e})}function s(e){return Object(r["a"])({url:"/categories",method:"post",data:{...e}})}function d(e){return Object(r["a"])({url:"/categories/"+e})}function i(e){return Object(r["a"])({url:"/categories/"+e.cat_id,method:"put",data:{cat_name:e.cat_name}})}function n(e){return Object(r["a"])({url:"/categories/"+e,method:"delete"})}function l(e,t){return Object(r["a"])({url:`/categories/${e}/attributes`,params:{sel:t}})}function c(e){return Object(r["a"])({url:`/categories/${e.id}/attributes`,method:"post",data:{attr_name:e.attr_name,attr_sel:e.attr_sel}})}function u(e){return Object(r["a"])({url:`/categories/${e.id}/attributes/${e.attrId}`,params:{attr_sel:e.attr_sel}})}function m(e){return Object(r["a"])({url:`/categories/${e.id}/attributes/${e.attrId}`,method:"put",data:{attr_name:e.attr_name,attr_sel:e.attr_sel}})}function g(e){return Object(r["a"])({url:`/categories/${e.id}/attributes/${e.attrId}`,method:"delete"})}function p(e){return Object(r["a"])({url:"/goods",params:e})}function b(e){return Object(r["a"])({url:"/goods/"+e,method:"delete"})}function h(e){return Object(r["a"])({url:"/goods",method:"post",data:e})}}}]);
//# sourceMappingURL=chunk-7b2449c2.070ecfda.js.map